{% extends "base.html" %}
{% load static %}

{% block title %}Change Password{% endblock title %}

{% block extra_head %}
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&amp;display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
<style>
  .material-symbols-outlined {
    font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
  }
  
  /* Override base.css button styles */
  button[type="submit"] {
    background: #10B981 !important;
    color: white !important;
    border: none !important;
    padding: 0.75rem 1.5rem !important;
    cursor: pointer !important;
    border-radius: 0.5rem !important;
    font-weight: bold !important;
    font-size: 0.875rem !important;
    transition: all 0.2s !important;
  }
  
  button[type="submit"]:hover {
    opacity: 0.9 !important;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important;
  }
  
  /* Ensure footer buttons are visible */
  footer button, footer a {
    z-index: 10 !important;
    position: relative !important;
  }
  
  /* Keep black borders on fields with errors - override Tailwind forms plugin */
  .field-error input[type="password"] {
    border-color: #000000 !important;
    border-width: 2px !important;
  }
  
  /* Dark mode support */
  @media (prefers-color-scheme: dark) {
    .field-error input[type="password"] {
      border-color: #ffffff !important;
    }
  }
  
  /* Also ensure the inline style is not overridden */
  input[type="password"][style*="border"] {
    border-style: solid !important;
  }#P
</style>
{% endblock extra_head %}

{% block content %}
<div class="relative flex min-h-screen w-full flex-col items-center justify-center p-4 font-display">
  <main class="w-full max-w-lg">
    <div class="flex flex-col rounded-xl border border-border-light dark:border-border-dark bg-white dark:bg-background-dark shadow-sm">
      <header class="flex items-center justify-between border-b border-solid border-border-light dark:border-border-dark p-6">
        <div class="flex items-center gap-4">
          <div class="size-6 text-primary">
            <svg fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6zm9 14H6V10h12v10zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z"></path>
            </svg>
          </div>
          <h2 class="text-xl font-bold leading-tight tracking-tight text-text-light dark:text-text-dark">Change Password</h2>
        </div>
      </header>
      
      <form method="post" class="flex flex-col gap-4 p-6">
        {% csrf_token %}
        
        {% if form.non_field_errors %}
        <div class="rounded-lg border border-l-4 border-error bg-red-50 dark:bg-red-900/20 p-4 text-sm text-error dark:text-red-400">
            <div class="font-bold mb-2">Password Change Failed</div>
            <ul class="space-y-1">
              {% for error in form.non_field_errors %}
                <li>â€¢ {{ error }}</li>
              {% endfor %}
            </ul>
        </div>
        {% endif %}

        <!-- Current Password -->
        <div class="flex flex-col {% if form.old_password.errors %}field-error{% endif %}">
          <label class="text-sm font-medium leading-normal pb-2 text-text-light dark:text-text-dark" for="{{ form.old_password.id_for_label }}">Current Password</label>
          <div class="relative flex w-full items-stretch">
            <input
              class="flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg bg-white dark:bg-background-light-alt text-text-light dark:text-text-dark focus:border-primary focus:ring-2 focus:ring-primary/20 h-12 p-3 text-sm font-normal leading-normal placeholder:text-placeholder-light dark:placeholder:text-placeholder-dark {% if form.old_password.errors %}has-error{% endif %}"
              style="border: 2px solid {% if form.old_password.errors %}black{% else %}rgb(222, 226, 230){% endif %} !important;"
              id="{{ form.old_password.id_for_label }}"
              name="{{ form.old_password.html_name }}"
              placeholder="Enter your current password"
              type="password"
              required
            />
            <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-3 text-placeholder-light dark:text-placeholder-dark toggle-password" data-target="{{ form.old_password.id_for_label }}">
              <span class="material-symbols-outlined text-xl">visibility_off</span>
            </button>
          </div>
          {% if form.old_password.errors %}
            <div class="rounded-lg border border-error bg-red-50 dark:bg-red-900/20 p-3 mt-2 text-sm text-error dark:text-red-400">
              <div class="flex gap-2">
                <span class="material-symbols-outlined text-base flex-shrink-0">error</span>
                <div class="flex-1">
                  {% for error in form.old_password.errors %}
                    <p class="mb-1">{{ error }}</p>
                  {% endfor %}
                </div>
              </div>
            </div>
          {% endif %}
        </div>

        <!-- New Password -->
        <div class="flex flex-col {% if form.new_password1.errors %}field-error{% endif %}">
          <label class="text-sm font-medium leading-normal pb-2 text-text-light dark:text-text-dark" for="{{ form.new_password1.id_for_label }}">New Password</label>
          <div class="relative flex w-full items-stretch">
            <input
              class="flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg bg-white dark:bg-background-light-alt text-text-light dark:text-text-dark focus:border-primary focus:ring-2 focus:ring-primary/20 h-12 p-3 text-sm font-normal leading-normal placeholder:text-placeholder-light dark:placeholder:text-placeholder-dark {% if form.new_password1.errors %}has-error{% endif %}"
              style="border: 2px solid {% if form.new_password1.errors %}black{% else %}rgb(222, 226, 230){% endif %} !important;"
              id="{{ form.new_password1.id_for_label }}"
              name="{{ form.new_password1.html_name }}"
              placeholder="Enter your new password"
              type="password"
              required
            />
            <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-3 text-placeholder-light dark:text-placeholder-dark toggle-password" data-target="{{ form.new_password1.id_for_label }}">
              <span class="material-symbols-outlined text-xl">visibility_off</span>
            </button>
          </div>
          {% if form.new_password1.help_text %}
            <p class="text-placeholder-light dark:text-placeholder-dark text-xs font-normal leading-normal pt-2 px-1">{{ form.new_password1.help_text|safe }}</p>
          {% endif %}
          {% if form.new_password1.errors %}
            <div class="rounded-lg border border-error bg-red-50 dark:bg-red-900/20 p-3 mt-2 text-sm text-error dark:text-red-400">
              <div class="flex gap-2">
                <span class="material-symbols-outlined text-base flex-shrink-0">error</span>
                <div class="flex-1">
                  {% for error in form.new_password1.errors %}
                    <p class="mb-1">{{ error }}</p>
                  {% endfor %}
                </div>
              </div>
            </div>
          {% endif %}
        </div>

        <!-- Confirm Password -->
        <div class="flex flex-col {% if form.new_password2.errors %}field-error{% endif %}">
          <label class="text-sm font-medium leading-normal pb-2 text-text-light dark:text-text-dark" for="{{ form.new_password2.id_for_label }}">Confirm New Password</label>
          <div class="relative flex w-full items-stretch">
            <input
              class="flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg bg-white dark:bg-background-light-alt text-text-light dark:text-text-dark focus:border-primary focus:ring-2 focus:ring-primary/20 h-12 p-3 text-sm font-normal leading-normal placeholder:text-placeholder-light dark:placeholder:text-placeholder-dark {% if form.new_password2.errors %}has-error{% endif %}"
              style="border: 2px solid {% if form.new_password2.errors %}black{% else %}rgb(222, 226, 230){% endif %} !important;"
              id="{{ form.new_password2.id_for_label }}"
              name="{{ form.new_password2.html_name }}"
              placeholder="Confirm your new password"
              type="password"
              required
            />
            <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-3 text-placeholder-light dark:text-placeholder-dark toggle-password" data-target="{{ form.new_password2.id_for_label }}">
              <span class="material-symbols-outlined text-xl">visibility_off</span>
            </button>
          </div>
          {% if form.new_password2.errors %}
            <div class="rounded-lg border border-error bg-red-50 dark:bg-red-900/20 p-3 mt-2 text-sm text-error dark:text-red-400">
              <div class="flex gap-2">
                <span class="material-symbols-outlined text-base flex-shrink-0">error</span>
                <div class="flex-1">
                  {% for error in form.new_password2.errors %}
                    <p class="mb-1">{{ error }}</p>
                  {% endfor %}
                </div>
              </div>
            </div>
          {% endif %}
        </div>

        <footer class="flex items-center justify-end gap-4 border-t border-solid border-border-light dark:border-border-dark p-6 -mx-6 -mb-6">
            <a href="{% url 'dashboard' %}"
              class="flex cursor-pointer items-center justify-center overflow-hidden rounded-lg h-11 bg-gray-5 px-5 text-sm font-bold text-text-light dark:text-text-dark hover:bg-gray-100 transition-colors border border-border-light dark:border-border-dark"
            >
              Cancel
            </a>
            <button type="submit" class="flex cursor-pointer items-center justify-center overflow-hidden rounded-lg h-11 bg-primary px-6 text-sm font-bold text-white transition-all hover:opacity-90 hover:shadow-lg">
              Save Changes
            </button>
        </footer>
      </form>
    </div>
  </main>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const toggleButtons = document.querySelectorAll('.toggle-password');
    
    toggleButtons.forEach(button => {
      button.addEventListener('click', function() {
        const targetId = this.getAttribute('data-target');
        const input = document.getElementById(targetId);
        const icon = this.querySelector('.material-symbols-outlined');
        
        if (input.type === 'password') {
          input.type = 'text';
          icon.textContent = 'visibility';
        } else {
          input.type = 'password';
          icon.textContent = 'visibility_off';
        }
      });
    });
  });
</script>
{% endblock content %}